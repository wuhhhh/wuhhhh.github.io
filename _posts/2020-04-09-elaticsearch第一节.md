---
layout:     post                    # 使用的布局（不需要改）
title:      Elasticsearch cp01              # 标题 
subtitle:   Hello World, Hello Blog #副标题
date:       2020-04-09             # 时间
author:     wuhhhh                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 技术
---
## 节点

>一个运行中的 Elasticsearch 实例称为一个节点，而集群是由一个或者多个拥有相同 cluster.name 配置的节点组成， 它们共同承担数据和负载的压力。当有节点加入集群中或者从集群中移除节点时，集群将会重新平均分布所有的数据。

---

## 主节点

>当一个节点被选举成为 主 节点时， 它将负责管理集群范围内的所有变更，例如增加、删除索引，或者增加、删除节点等。 而主节点并不需要涉及到文档级别的变更和搜索等操作，所以当集群只拥有一个主节点的情况下，即使流量的增加它也不会成为瓶颈。 任何节点都可以成为主节点。我们的示例集群就只有一个节点，所以它同时也成为了主节点。

## 集群健康

>Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 集群健康 ， 它在 `status`字段中展示为`green`、 `yellow` 或者 `red` 。

`GET /_cluster/health`

出现结果后，`status` 字段是我们最关心的。

`status` 字段指示着当前集群在总体上是否工作正常。它的三种颜色含义如下：

`green`
所有的主分片和副本分片都正常运行。

`yellow`
所有的主分片都正常运行，但不是所有的副本分片都正常运行。

`red`
有主分片没能正常运行。

## 添加索引

>一个 分片 是一个底层的 工作单元 ，它仅保存了全部数据中的一部分。现在我们只需知道一个分片是一个 Lucene 的实例。
>>Elasticsearch 是利用分片将数据分发到集群内各处的。分片是数据的容器，文档保存在分片内，分片又被分配到集群内的各个节点里。 当你的集群规模扩大或者缩小时， Elasticsearch 会自动的在各节点中迁移分片，使得数据仍然均匀分布在集群里。
>>>一个分片可以是 主 分片或者 副本 分片。 索引内任意一个文档都归属于一个主分片，所以主分片的数目决定着索引能够保存的最大数据量。

![blockchain](https://raw.githubusercontent.com/wuhhhh/picGo/master/D%3A%5CtestArea%5Cimglistes%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7.png)

>集群的健康状况为 yellow 则表示全部 主 分片都正常运行（集群可以正常服务所有请求），但是 副本 分片没有全部处在正常状态。 实际上，所有3个副本分片都是 unassigned —— 它们都没有被分配到任何节点。 在同一个节点上既保存原始数据又保存副本是没有意义的，因为一旦失去了那个节点，我们也将丢失该节点上的所有副本数据。

<font color=red>`当前我们的集群是正常运行的，但是在硬件故障时有丢失数据的风险。`</font>

故障转移：[解决办法](https://www.elastic.co/guide/cn/elasticsearch/guide/current/_add_failover.html)

## 什么是文档(doc)

>通常情况下，我们使用的术语 对象 和 文档 是可以互相替换的。不过，有一个区别： 一个对象仅仅是类似于 hash 、 hashmap 、字典或者关联数组的 JSON 对象，对象中也可以嵌套其他的对象。 对象可能包含了另外一些对象。
>> 在 Elasticsearch 中，术语 文档 有着特定的含义。它是指最顶层或者根对象, 这个根对象被序列化成 JSON 并存储到 Elasticsearch 中，指定了唯一 ID。

<font color=red>`字段的名字可以是任何合法的字符串，但 不可以 包含英文句号(.)。`</font>

## 文档元数据

一个文档不仅仅包含它的数据 ，也包含 元数据 —— 有关 文档的信息。 三个必须的元数据元素如下：

### _index

文档在哪存放

### _type

文档表示的对象类别

### _id

文档唯一标识

